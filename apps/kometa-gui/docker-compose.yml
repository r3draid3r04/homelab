services:
  kometagui:
    image: registry.kylerockwell.dev/docker/kometagui:0.9.16
    container_name: kometagui
    ports:
      - 3005:3000
      - 3001:3001
    environment:
      - NODE_ENV=${NODE_ENV:-development}
      - PORT=${PORT:-3001}
      - CONFIG_DIR=${CONFIG_DIR:-/config}
      - LOGS_DIR=${LOGS_DIR:-/logs}
      - KOMETA_CONTAINER_NAME=${KOMETA_CONTAINER_NAME:-kometa}
      - FRONTEND_URL=${FRONTEND_URL:-http://localhost:3000}
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - NEXT_PUBLIC_API_URL=${NEXT_PUBLIC_API_URL:-http://localhost:3001}
      - NEXT_PUBLIC_WS_URL=${NEXT_PUBLIC_WS_URL:-http://localhost:3001}
      # Mediux Configuration
      - MEDIUX_API_URL=${MEDIUX_API_URL:-https://staged.mediux.io/graphql}
      - MEDIUX_API_TOKEN=${MEDIUX_API_TOKEN}
      - MEDIUX_ASSET_URL=${MEDIUX_ASSET_URL:-https://staged.mediux.io/assets}
      - MEDIUX_CACHE_DIR=${MEDIUX_CACHE_DIR:-/cache/mediux}
      - MEDIUX_SYNC_INTERVAL=${MEDIUX_SYNC_INTERVAL:-0 0 * * *}
      - DATABASE_URL=${DATABASE_URL:-file:/data/dev.db}
    restart: unless-stopped
    volumes:
      - /home/kyle/appdata/kometa/configs:/config
      - /home/kyle/appdata/kometagui/cache:/cache
      - /home/kyle/appdata/kometagui/data:/data
      - /home/kyle/appdata/kometa/logs:/logs
      - /var/run/docker.sock:/var/run/docker.sock:ro
    #depends_on:
    #  - kometa
    networks:
      cn1: null
  kometa:
    image: kometateam/kometa:nightly # Use nightly if you want to be able to set logos
    container_name: kometa
    environment:
      - TZ=America/Chicago
      - KOMETA_CONFIG=/config/config.yml
      - KOMETA_TIME=06:00
      - KOMETA_RUN=false
      - KOMETA_NO_MISSING=false
      - KOMETA_NO_REPORT=false
    volumes:
      - /home/kyle/appdata/kometa/configs:/config
      - /home/kyle/appdata/kometa/logs:/logs
      - /home/kyle/appdata/kometa/cache:/cache
    labels:
      - diun.enable=true
    restart: unless-stopped
    networks:
      cn1: null
networks:
  cn1:
    external: true
